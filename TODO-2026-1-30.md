# 湖畔通市场（Lakeshore Exchange）开发待办清单

**创建日期：** 2026年1月30日  
**项目状态：** MVP阶段，前端UI完成度90%，后端Mock API完成度30%

---

## 📊 当前完成情况概览

### ✅ 已完成功能（90%）

#### 基础架构
- [x] 前后端项目搭建（React 18 + Express + TypeScript）
- [x] 路由系统（React Router v6）
- [x] 状态管理（Zustand）
- [x] API客户端封装（Axios）
- [x] 青色科技风格UI主题
- [x] Ant Design 5.x 集成

#### 用户系统
- [x] 登录/注册页面
- [x] 快速登录（3个Demo账户）
  - 水珠资本管理有限公司
  - 露珠资本有限合伙
  - 湖畔通平台管理员
- [x] 角色权限系统（投资人、项目方、管理员）
- [x] 角色菜单动态显示

#### 投资人功能模块
- [x] 首页仪表板
  - KPI统计卡片（总资产规模、投资人数量、在线项目、平均投资回报率）
  - 热门项目募资进度图表（ECharts）
  - 市场资产分布饼图
  - 热门投资机会列表（4个精选项目）
- [x] 市场浏览器
  - 资产列表展示（3列布局）
  - 多维度筛选（类型、风险等级、预期回报率）
  - 项目卡片（18px标题，统一样式）
  - 募资进度显示
- [x] 资产详情页（基础版）
- [x] 投资组合（按账户区分）
  - 水珠资本：独立持仓
  - 露珠资本：独立持仓
- [x] 匹配工作台
- [x] 偏好设置（完整P0+P1功能）
  - 基本信息修改
  - 联系方式更新（带验证码验证UI）
  - 修改密码（密码强度验证）
  - 银行卡绑定/管理
    - 添加/编辑/删除银行卡
    - 设置默认卡
    - 卡号脱敏显示
  - 账户资金管理
    - 账户余额显示
    - 可提金额（余额 - 冻结金额）
    - 冻结金额（带说明提示）
    - 入金功能（模拟）
    - 出金功能（模拟，带限额验证）
  - 通知偏好设置
    - 通知渠道开关（邮件/短信/站内/微信）
    - 通知内容选择（投资机会/持仓变动/分红通知等）
    - 免打扰时段设置
  - 投资偏好/风险评估
    - 风险承受能力选择（5个等级）
    - 关注行业类别（8个行业）
    - 投资金额区间（10万-1000万）
    - 投资期限偏好
    - 预期年化收益率
    - AI智能推荐开关
  - 双重验证（2FA）
    - 短信验证开关
    - 邮箱验证开关
    - Google Authenticator绑定UI（含二维码）
  - 对账单下载
    - 定期对账单列表
    - PDF/Excel下载按钮
    - 自定义时间范围生成

#### 管理员功能
- [x] 中央厨房页面
  - 资产管道统计
  - 风险监控仪表板
  - 资产类型分布
  - 统计概览

#### 项目方功能
- [x] 我的项目页面
  - 项目列表
  - 状态管理（待审核/已上架/已下架）

#### Demo数据
- [x] 12个资产项目
  - 2个母基金（MIFC主基金LP份额、MIFC ABS优先级份额）
  - 10个跟投项目
- [x] 2个投资人账户差异化数据
  - 水珠资本：2张银行卡，余额¥256,800，冻结¥71,800
  - 露珠资本：1张银行卡，余额¥128,000，冻结¥32,000
- [x] 风险级别调整（MIFC主基金LP：高风险→中风险）

---

## ⚠️ 部分完成功能（需补全后端）

### 1. 投资流程
- [x] 前端UI：资产详情页、投资按钮
- [ ] 后端API：投资下单、订单管理
- [ ] 数据库：投资记录表
- [ ] 支付集成

### 2. 项目审批流程
- [x] 前端UI：项目提交表单、状态显示
- [ ] 后端：审批工作流引擎
- [ ] 状态机实现
- [ ] 审批通知

### 3. 资产详情页增强
- [x] 基础信息展示
- [ ] 收益计算器（交互式）
- [ ] 风险评估详情
- [ ] 历史收益曲线图
- [ ] 投资人评论/问答区

### 4. 用户中心增强
- [x] 偏好设置UI
- [ ] 消息中心（站内信）
- [ ] 操作日志
- [ ] 实名认证流程

---

## ❌ 未实装的核心功能（优先级排序）

### P0 - 核心必备功能

#### 1. 数据持久化（最高优先级）
- [ ] Prisma ORM真实连接
  - [ ] 数据库选型（开发：SQLite，生产：PostgreSQL）
  - [ ] 执行 prisma migrate
  - [ ] 数据库种子数据脚本
- [ ] 核心表设计与实现：
  ```prisma
  - [ ] User（用户表）
  - [ ] Investment（投资记录）
  - [ ] Transaction（交易记录）
  - [ ] BankCard（银行卡）
  - [ ] Asset（资产）
  - [ ] Project（项目）
  - [ ] Notification（通知）
  - [ ] Statement（对账单）
  - [ ] AuditLog（操作日志）
  ```

#### 2. 认证与安全
- [ ] JWT真实实现
  - [ ] 生成与验证
  - [ ] Token刷新机制
  - [ ] 过期处理
- [ ] 密码加密存储
  - [ ] bcrypt集成
  - [ ] 密码强度验证
- [ ] 中间件：
  - [ ] 认证中间件
  - [ ] 权限验证中间件
  - [ ] CORS安全配置

#### 3. 投资流程完整实现
- [ ] 投资下单API
  - [ ] POST /api/investments/create
  - [ ] 资金冻结逻辑
  - [ ] 库存扣减
- [ ] 订单管理
  - [ ] 订单状态机（待支付→已支付→确认中→已完成）
  - [ ] 订单查询
  - [ ] 订单取消
- [ ] 投资记录
  - [ ] 查询我的投资
  - [ ] 收益计算
  - [ ] 分红记录

---

### P1 - 重要功能（第二优先级）

#### 4. 验证码服务
- [ ] 短信验证码
  - [ ] 接入阿里云SMS / 腾讯云SMS
  - [ ] 验证码生成与存储（Redis）
  - [ ] 发送频率限制
  - [ ] 验证码校验
- [ ] 邮箱验证码
  - [ ] 接入SendGrid / 阿里云邮件推送
  - [ ] 邮件模板设计
  - [ ] 发送与验证

#### 5. 文件管理系统
- [ ] 云存储集成
  - [ ] 阿里云OSS / AWS S3
  - [ ] 上传文件API
  - [ ] 文件URL生成
- [ ] 对账单生成
  - [ ] PDF生成（pdfkit / puppeteer）
  - [ ] Excel导出（exceljs）
  - [ ] 自定义时间范围报表
- [ ] 投资协议
  - [ ] 协议模板管理
  - [ ] 电子签名集成
- [ ] 合规文档
  - [ ] 文档上传
  - [ ] 文档审核
  - [ ] 版本管理

#### 6. 支付集成（模拟阶段）
- [ ] 入金流程
  - [ ] 银行转账确认（手动审核）
  - [ ] 账户余额增加
  - [ ] 入金记录
- [ ] 出金流程
  - [ ] 提现申请
  - [ ] 审批流程
  - [ ] 到账确认
  - [ ] 出金记录
- [ ] 交易记录
  - [ ] 资金流水
  - [ ] 对账功能

#### 7. 实名认证
- [ ] 身份证OCR识别
  - [ ] 接入阿里云OCR / 腾讯云OCR
  - [ ] 自动提取姓名、身份证号
- [ ] 活体检测（人脸识别）
- [ ] 审核流程
  - [ ] 管理员审核界面
  - [ ] 审核通过/拒绝
  - [ ] 通知用户

---

### P2 - 增强功能（第三优先级）

#### 8. 通知系统
- [ ] 站内消息
  - [ ] 消息中心页面
  - [ ] 未读消息提示
  - [ ] 消息分类（系统通知、投资提醒、审批通知）
- [ ] 邮件通知
  - [ ] 重要事件邮件推送
  - [ ] 邮件模板
- [ ] 短信通知
  - [ ] 关键操作短信提醒
- [ ] 微信推送
  - [ ] 服务号消息推送
  - [ ] 模板消息
- [ ] 实时通知（可选）
  - [ ] WebSocket集成
  - [ ] 浏览器通知

#### 9. 风险评估问卷
- [ ] 问卷设计
  - [ ] 多维度问题（年龄、收入、投资经验等）
  - [ ] 评分算法
- [ ] 风险等级计算
  - [ ] 保守型、稳健型、平衡型、进取型、激进型
- [ ] 投资建议
  - [ ] 根据风险等级推荐产品
  - [ ] 资产配置建议

#### 10. 数据分析与报表
- [ ] 投资收益分析
  - [ ] 收益曲线图
  - [ ] 收益排名
- [ ] 资产配置分析
  - [ ] 资产分布饼图
  - [ ] 行业分布
- [ ] 风险敞口监控
  - [ ] 集中度风险
  - [ ] 流动性风险
- [ ] 自定义报表
  - [ ] 报表模板
  - [ ] 数据导出

#### 11. AI推荐系统
- [ ] 用户画像
  - [ ] 投资偏好标签
  - [ ] 行为分析
- [ ] 推荐算法
  - [ ] 协同过滤
  - [ ] 内容推荐
- [ ] 智能匹配
  - [ ] 项目推荐
  - [ ] 投资人匹配

---

### P3 - 优化改进（第四优先级）

#### 12. 性能优化
- [ ] 前端优化
  - [ ] 图片懒加载
  - [ ] 路由懒加载
  - [ ] 虚拟滚动（长列表）
  - [ ] 打包体积优化
- [ ] 后端优化
  - [ ] API响应缓存（Redis）
  - [ ] 数据库查询优化（索引）
  - [ ] API接口限流
- [ ] CDN部署
  - [ ] 静态资源CDN
  - [ ] 全站加速

#### 13. 测试覆盖
- [ ] 单元测试
  - [ ] Jest + React Testing Library
  - [ ] 覆盖率目标：80%
- [ ] 集成测试
  - [ ] API接口测试
  - [ ] 数据库操作测试
- [ ] E2E测试
  - [ ] Playwright / Cypress
  - [ ] 关键业务流程测试

#### 14. 安全加固
- [ ] XSS防护
  - [ ] 输入验证
  - [ ] 输出编码
- [ ] CSRF防护
  - [ ] CSRF Token
- [ ] SQL注入防护
  - [ ] 参数化查询（Prisma已提供）
- [ ] 敏感数据加密
  - [ ] 数据库字段加密
  - [ ] HTTPS传输
- [ ] API接口限流
  - [ ] Rate Limiting中间件

#### 15. 移动端适配
- [ ] 响应式优化
  - [ ] 移动端菜单优化
  - [ ] 表格横向滚动
  - [ ] 触摸操作优化
- [ ] PWA支持
  - [ ] Service Worker
  - [ ] 离线缓存
- [ ] 移动App（长期）
  - [ ] React Native
  - [ ] 微信小程序

#### 16. DevOps自动化
- [ ] Docker容器化
  - [ ] Dockerfile编写
  - [ ] docker-compose配置
- [ ] CI/CD流水线
  - [ ] GitHub Actions / GitLab CI
  - [ ] 自动化测试
  - [ ] 自动化部署
- [ ] 日志收集
  - [ ] Winston / Pino
  - [ ] 日志聚合（ELK）
- [ ] 错误追踪
  - [ ] Sentry集成
  - [ ] 错误告警
- [ ] 监控告警
  - [ ] 性能监控
  - [ ] 可用性监控

---

## 🔧 技术债务清单

### 代码质量
- [ ] ESLint规则完善
- [ ] Prettier代码格式化统一
- [ ] TypeScript类型完善（消除any）
- [ ] 代码注释补充
- [ ] API文档（Swagger / OpenAPI）

### 架构优化
- [ ] 微服务拆分（可选，视规模而定）
- [ ] 消息队列引入（Redis / RabbitMQ）
- [ ] 缓存策略优化
- [ ] 数据库读写分离（生产环境）

---

## 📋 具体待实现API清单

### 认证模块
```typescript
POST   /api/auth/register          // 用户注册（真实）
POST   /api/auth/login             // 用户登录（JWT）
POST   /api/auth/logout            // 退出登录
POST   /api/auth/refresh-token     // 刷新Token
GET    /api/auth/me                // 获取当前用户信息
POST   /api/auth/verify-identity   // 实名认证
```

### 投资模块
```typescript
POST   /api/investments/create     // 创建投资订单
GET    /api/investments/my         // 我的投资列表
GET    /api/investments/:id        // 投资详情
POST   /api/investments/:id/cancel // 取消投资
GET    /api/investments/statistics // 投资统计
```

### 资产模块（已有，需完善）
```typescript
GET    /api/assets                 // 资产列表（已有）
GET    /api/assets/:id             // 资产详情（已有）
POST   /api/assets                 // 创建资产（管理员）
PUT    /api/assets/:id             // 更新资产（管理员）
DELETE /api/assets/:id             // 删除资产（管理员）
```

### 用户设置模块（已有UI，需实现后端）
```typescript
GET    /api/settings/profile       // 获取用户信息（已有mock）
PUT    /api/settings/profile       // 更新用户信息（已有mock）
PUT    /api/settings/contact       // 更新联系方式（已有mock）
PUT    /api/settings/password      // 修改密码（已有mock）
GET    /api/settings/bank-cards    // 获取银行卡列表（已有mock）
POST   /api/settings/bank-cards    // 添加银行卡（已有mock）
PUT    /api/settings/bank-cards/:id // 更新银行卡（已有mock）
DELETE /api/settings/bank-cards/:id // 删除银行卡（已有mock）
```

### 验证码模块
```typescript
POST   /api/verification/send-sms    // 发送短信验证码
POST   /api/verification/send-email  // 发送邮箱验证码
POST   /api/verification/verify      // 验证验证码
```

### 支付模块
```typescript
POST   /api/payments/deposit       // 入金申请
POST   /api/payments/withdraw      // 出金申请
GET    /api/payments/transactions  // 交易记录
GET    /api/payments/balance       // 账户余额
```

### 对账单模块
```typescript
GET    /api/statements             // 对账单列表（已有mock）
POST   /api/statements/generate    // 生成对账单（已有mock）
GET    /api/statements/:id/download // 下载对账单
```

### 通知模块
```typescript
GET    /api/notifications          // 通知列表
PUT    /api/notifications/:id/read // 标记已读
DELETE /api/notifications/:id      // 删除通知
GET    /api/notifications/unread-count // 未读数量
```

### 文件上传
```typescript
POST   /api/upload/avatar          // 上传头像
POST   /api/upload/document        // 上传文档
POST   /api/upload/identity        // 上传身份证
```

---

## 🎯 近期开发建议（按周计划）

### 第1周：数据库与认证
- [ ] 配置Prisma连接真实数据库
- [ ] 创建User、BankCard、Transaction表
- [ ] 实现JWT认证
- [ ] 实现密码加密存储
- [ ] 完成登录/注册真实API

### 第2周：投资流程
- [ ] 创建Investment表
- [ ] 实现投资下单API
- [ ] 实现投资记录查询
- [ ] 实现资金冻结/解冻逻辑
- [ ] 完成投资流程端到端测试

### 第3周：验证码与文件上传
- [ ] 接入短信服务商
- [ ] 接入邮件服务
- [ ] 实现验证码发送与验证
- [ ] 接入云存储（OSS）
- [ ] 实现文件上传API

### 第4周：对账单与支付
- [ ] 实现PDF对账单生成
- [ ] 实现入金/出金流程
- [ ] 完善交易记录
- [ ] 创建管理员审核界面

---

## 🛠️ 技术选型建议

### 后端
- **数据库（开发）：** SQLite（已配置，无需额外服务）
- **数据库（生产）：** PostgreSQL 14+
- **ORM：** Prisma（已引入）
- **认证：** JWT (jsonwebtoken)
- **密码加密：** bcrypt
- **验证码存储：** Redis（或内存Map，简单场景）
- **文件上传：** multer + 阿里云OSS
- **PDF生成：** pdfkit / puppeteer
- **Excel生成：** exceljs

### 第三方服务
- **短信：** 阿里云SMS / 腾讯云SMS
- **邮件：** SendGrid / 阿里云邮件推送
- **存储：** 阿里云OSS / AWS S3
- **OCR：** 阿里云OCR（身份证识别）
- **支付：** 支付宝 / 微信支付（后期接入）

### 前端（已完成）
- React 18 + TypeScript
- Ant Design 5.x
- Zustand（状态管理）
- ECharts（图表）
- React Router v6

---

## 📦 依赖安装清单（待添加）

### 后端新增依赖
```bash
# 认证与安全
npm install jsonwebtoken bcryptjs
npm install @types/jsonwebtoken @types/bcryptjs -D

# 验证码
npm install redis
npm install @types/redis -D

# 文件上传
npm install multer ali-oss
npm install @types/multer -D

# PDF/Excel生成
npm install pdfkit exceljs

# 日期处理
npm install dayjs

# 验证库
npm install joi
npm install @types/joi -D

# 邮件
npm install nodemailer
npm install @types/nodemailer -D
```

### 前端新增依赖（已完成）
```bash
# dayjs已安装
npm install dayjs  # ✅ 已完成
```

---

## 📝 数据库Schema示例

```prisma
// prisma/schema.prisma

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  name          String
  phone         String?
  role          String         @default("INVESTOR")
  isVerified    Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  
  bankCards     BankCard[]
  investments   Investment[]
  transactions  Transaction[]
  notifications Notification[]
}

model BankCard {
  id            String   @id @default(uuid())
  userId        String
  bankName      String
  cardNumber    String
  accountType   String
  branch        String
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
}

model Investment {
  id            String   @id @default(uuid())
  userId        String
  assetId       String
  amount        Int
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
}

model Transaction {
  id            String   @id @default(uuid())
  userId        String
  type          String   // DEPOSIT, WITHDRAW, INVESTMENT, DIVIDEND
  amount        Int
  status        String   @default("PENDING")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  user          User     @relation(fields: [userId], references: [id])
}

model Notification {
  id            String   @id @default(uuid())
  userId        String
  title         String
  content       String
  type          String
  isRead        Boolean  @default(false)
  createdAt     DateTime @default(now())
  
  user          User     @relation(fields: [userId], references: [id])
}
```

---

## 🚀 部署检查清单（上线前）

### 安全检查
- [ ] 所有敏感信息移至环境变量
- [ ] API接口添加认证
- [ ] 实现CORS白名单
- [ ] SQL注入防护
- [ ] XSS防护
- [ ] CSRF Token
- [ ] HTTPS证书配置

### 性能检查
- [ ] 数据库索引优化
- [ ] API响应缓存
- [ ] 静态资源压缩
- [ ] 图片优化
- [ ] CDN配置

### 功能检查
- [ ] 用户注册/登录流程测试
- [ ] 投资下单流程测试
- [ ] 支付流程测试
- [ ] 邮件/短信发送测试
- [ ] 文件上传/下载测试
- [ ] 移动端兼容性测试

### 监控配置
- [ ] 错误日志收集
- [ ] 性能监控
- [ ] 服务器资源监控
- [ ] 告警配置

---

## 📞 相关资源与文档

### 官方文档
- [Prisma文档](https://www.prisma.io/docs)
- [Ant Design文档](https://ant.design/docs/react/introduce-cn)
- [React Router文档](https://reactrouter.com/)
- [ECharts文档](https://echarts.apache.org/zh/index.html)

### 第三方服务
- [阿里云OSS](https://help.aliyun.com/product/31815.html)
- [阿里云SMS](https://help.aliyun.com/product/44282.html)
- [SendGrid](https://docs.sendgrid.com/)

### 开发工具
- [Postman](https://www.postman.com/) - API测试
- [Prisma Studio](https://www.prisma.io/studio) - 数据库GUI
- [React DevTools](https://react.dev/learn/react-developer-tools)

---

## 📌 备注

1. **优先级说明：**
   - P0：核心必备，影响基础功能
   - P1：重要功能，增强用户体验
   - P2：增强功能，提升产品竞争力
   - P3：优化改进，长期持续优化

2. **开发原则：**
   - 先实现核心功能，再完善细节
   - 后端API先做简单实现，逐步完善
   - 安全性贯穿始终，不可妥协
   - 用户体验优先，保持界面一致性

3. **代码管理：**
   - 功能开发使用feature分支
   - 定期合并到main分支
   - 重要节点打tag标记

4. **测试策略：**
   - 关键功能必须有测试覆盖
   - 上线前完整回归测试
   - 生产环境灰度发布

---

**最后更新：** 2026年1月30日  
**下次复盘：** 根据开发进度更新待办清单

---

## ✅ 已完成的近期更新（2026-01-30）

- [x] 删除头像上传功能
- [x] 银行账户页面增加资金管理（余额、可提金额、冻结金额）
- [x] 添加入金/出金功能UI
- [x] 根据不同投资人账户设置差异化银行卡和资金数据
- [x] 修改冻结金额逻辑（可提金额 = 账户余额 - 冻结金额）
- [x] 添加冻结金额说明提示（Tooltip）
- [x] 修改MIFC主基金LP风险级别（高风险→中风险，评分68→55）
- [x] 修改首页仪表板热门资产为指定4个项目
- [x] 修复市场浏览器筛选范围（0-25% → 0-40%）
- [x] 修复项目卡标题字号不一致问题（统一为18px）
- [x] 创建TODO-2026-1-30.md开发待办清单
